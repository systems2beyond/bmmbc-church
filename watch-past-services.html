<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Watch Past Services - Bethel Metropolitan Baptist Church</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="logo">
                <h1>Bethel Metropolitan Baptist Church</h1>
                <p>St. Petersburg, FL</p>
            </div>
            <button class="mobile-menu-toggle" aria-label="Toggle mobile menu">☰</button>
            <nav class="main-nav">
                <ul>
                    <li><a href="index.html">Home</a></li>
                    <li><a href="about-us.html">About Us</a></li>
                    <li><a href="index.html#events">Events</a></li>
                    <li><a href="visit-us.html">Visit Us</a></li>
                    <li><a href="watch-past-services.html">Watch</a></li>
                    <li><a href="https://www.givelify.com/givenow/1.0/?token=eyJvcmdfaWQiOiJNVFV5TURJfiIsImJhZGdlX2ltYWdlIjoiYjMucG5nIn0" class="btn btn-give" target="_blank">Give</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- Watch Past Services Hero -->
    <section class="page-hero">
        <div class="hero-content">
            <h1>Watch Past Services</h1>
            <p>Never miss a Sunday again - Catch up on our recent worship services</p>
        </div>
    </section>

    <!-- Theme Scripture -->
    <section class="theme-scripture">
        <div class="container">
            <div class="scripture-content">
                <h2>Theme Scriptures</h2>
                <blockquote>
                    <p>"For I determined not to know anything among you, save Jesus Christ, and Him Crucified."</p>
                    <cite>1 Corinthians 2:2</cite>
                </blockquote>
                <blockquote>
                    <p>"…I count all things but loss for the excellency of the knowledge of Christ Jesus my Lord…"</p>
                    <cite>Philippians 3:8</cite>
                </blockquote>
            </div>
        </div>
    </section>

    <!-- YouTube Channel Integration -->
    <section class="past-services">
        <div class="container">
            <h2>Recent Services</h2>
            <div class="services-grid" id="services-grid">
                <!-- Videos will be loaded here dynamically -->
                <div class="loading-message">
                    <p>Loading recent services...</p>
                </div>
            </div>
            
            <!-- Channel Link -->
            <div class="channel-link">
                <a href="https://www.youtube.com/@BethelMetropolitanBaptistCh" target="_blank" class="btn btn-primary">
                    Visit Our YouTube Channel
                </a>
            </div>
        </div>
    </section>

    <!-- Live Stream Section -->
    <section class="live-stream-info">
        <div class="container">
            <h2>Join Us Live</h2>
            <p>Don't miss our live worship services every Sunday at 10:15 AM</p>
            <div class="service-times">
                <div class="service-time">
                    <h3>Sunday School</h3>
                    <p>9:00 AM</p>
                </div>
                <div class="service-time">
                    <h3>Worship Service</h3>
                    <p>10:15 AM</p>
                </div>
                <div class="service-time">
                    <h3>Children's Church</h3>
                    <p>10:15 AM</p>
                </div>
            </div>
            <a href="https://youtube.com/live/DyJavhSxNdA?feature=share" target="_blank" class="btn btn-primary">
                Watch Live Now
            </a>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>Contact Us</h3>
                    <p>Phone: (727) 327-0554</p>
                    <p><a href="mailto:bchurch5@tampabay.rr.com">bchurch5@tampabay.rr.com</a></p>
                    <p>3455 26th Avenue South<br>St. Petersburg, FL 33711</p>
                </div>
                <div class="footer-section">
                    <h3>Service Times</h3>
                    <p>Sunday School: 9:00 AM</p>
                    <p>Worship Service: 10:15 AM</p>
                    <p>Children's Church: 10:15 AM</p>
                </div>
                <div class="footer-section">
                    <h3>Connect</h3>
                    <p><a href="https://youtube.com/live/DyJavhSxNdA?feature=share" target="_blank">Watch Live</a></p>
                    <p><a href="https://www.givelify.com/givenow/1.0/?token=eyJvcmdfaWQiOiJNVFV5TURJfiIsImJhZGdlX2ltYWdlIjoiYjMucG5nIn0" target="_blank">Give Online</a></p>
                    <p><a href="https://us02web.zoom.us/j/81224188515" target="_blank">Join Zoom Meeting</a></p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 Bethel Metropolitan Baptist Church. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script>
        // YouTube API Configuration
        // Note: You'll need to get a YouTube Data API key from Google Cloud Console
        // and replace 'YOUR_API_KEY' with your actual API key
        const API_KEY = 'AIzaSyDV794mQoF3Dfb8uV1LE-hW6yipfJAvxmM'; // YouTube Data API key
        const CHANNEL_USERNAME = 'BethelMetropolitanBaptistCh'; // BMBC's YouTube channel username
        const MAX_RESULTS = 6; // Number of recent videos to display
        
        // YouTube API Functions
        async function getChannelId(username) {
            try {
                const response = await fetch(
                    `https://www.googleapis.com/youtube/v3/channels?part=id&forUsername=${username}&key=${API_KEY}`
                );
                const data = await response.json();
                
                if (data.items && data.items.length > 0) {
                    return data.items[0].id;
                }
                
                // If username doesn't work, try searching by channel name
                const searchResponse = await fetch(
                    `https://www.googleapis.com/youtube/v3/search?part=snippet&type=channel&q=Bethel Metropolitan Baptist Church&key=${API_KEY}`
                );
                const searchData = await searchResponse.json();
                
                if (searchData.items && searchData.items.length > 0) {
                    return searchData.items[0].snippet.channelId;
                }
                
                throw new Error('Channel not found');
            } catch (error) {
                console.error('Error getting channel ID:', error);
                return null;
            }
        }
        
        async function getRecentVideos(channelId) {
            try {
                const response = await fetch(
                    `https://www.googleapis.com/youtube/v3/search?part=snippet&channelId=${channelId}&type=video&order=date&maxResults=${MAX_RESULTS}&key=${API_KEY}`
                );
                const data = await response.json();
                
                if (data.items) {
                    return data.items.map(item => ({
                        videoId: item.id.videoId,
                        title: item.snippet.title,
                        description: item.snippet.description,
                        publishedAt: new Date(item.snippet.publishedAt),
                        thumbnail: item.snippet.thumbnails.medium.url
                    }));
                }
                
                return [];
            } catch (error) {
                console.error('Error fetching videos:', error);
                return [];
            }
        }
        
        function formatDate(date) {
            return date.toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }
        
        function createVideoCard(video) {
            const serviceCard = document.createElement('div');
            serviceCard.className = 'service-card';
            
            // Truncate description if too long
            const description = video.description.length > 100 
                ? video.description.substring(0, 100) + '...' 
                : video.description;
            
            serviceCard.innerHTML = `
                <div class="video-container">
                    <iframe 
                        src="https://www.youtube.com/embed/${video.videoId}" 
                        frameborder="0" 
                        allowfullscreen
                        loading="lazy">
                    </iframe>
                </div>
                <div class="service-info">
                    <h3>${video.title}</h3>
                    <p class="service-date">${formatDate(video.publishedAt)}</p>
                    <p class="service-description">${description}</p>
                </div>
            `;
            
            return serviceCard;
        }
        
        function showFallbackVideos() {
            // Fallback videos when API is not available or configured
            const fallbackVideos = [
                {
                    videoId: "DyJavhSxNdA",
                    title: "Sunday Worship Service - Live Stream",
                    description: "Join us for worship and the Word",
                    publishedAt: new Date()
                },
                {
                    videoId: "njbPUJRAdaU",
                    title: "Knowing Jesus in 2024",
                    description: "Dr. Rickey L. Houston, Preaching",
                    publishedAt: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000) // 1 week ago
                }
            ];
            
            return fallbackVideos;
        }
        
        async function loadRecentServices() {
            const servicesGrid = document.getElementById('services-grid');
            
            try {
                // Check if API key is configured
                if (API_KEY === 'YOUR_API_KEY') {
                    console.log('YouTube API key not configured, using fallback videos');
                    const fallbackVideos = showFallbackVideos();
                    displayVideos(fallbackVideos, servicesGrid);
                    showApiSetupMessage();
                    return;
                }
                
                // Get channel ID and fetch recent videos
                const channelId = await getChannelId(CHANNEL_USERNAME);
                
                if (!channelId) {
                    throw new Error('Could not find channel');
                }
                
                const videos = await getRecentVideos(channelId);
                
                if (videos.length === 0) {
                    throw new Error('No videos found');
                }
                
                displayVideos(videos, servicesGrid);
                
            } catch (error) {
                console.error('Error loading recent services:', error);
                // Show fallback videos on error
                const fallbackVideos = showFallbackVideos();
                displayVideos(fallbackVideos, servicesGrid);
                showApiSetupMessage();
            }
        }
        
        function displayVideos(videos, container) {
            // Clear loading message
            container.innerHTML = '';
            
            // Create video cards
            videos.forEach(video => {
                const videoCard = createVideoCard(video);
                container.appendChild(videoCard);
            });
        }
        
        function showApiSetupMessage() {
            const servicesGrid = document.getElementById('services-grid');
            const setupMessage = document.createElement('div');
            setupMessage.className = 'api-setup-message';
            setupMessage.innerHTML = `
                <div class="setup-notice">
                    <h3>🔧 API Setup Required</h3>
                    <p>To display the most recent videos automatically, you'll need to:</p>
                    <ol>
                        <li>Get a YouTube Data API key from <a href="https://console.cloud.google.com/" target="_blank">Google Cloud Console</a></li>
                        <li>Replace 'YOUR_API_KEY' in the code with your actual API key</li>
                        <li>The page will then automatically fetch the latest videos from BMBC's channel</li>
                    </ol>
                    <p><strong>Currently showing sample videos for demonstration.</strong></p>
                </div>
            `;
            servicesGrid.appendChild(setupMessage);
        }
        
        // Load services when page loads
        document.addEventListener('DOMContentLoaded', loadRecentServices);
        
        // Auto-refresh every 30 minutes to get new videos
        setInterval(loadRecentServices, 30 * 60 * 1000);
        
        // Mobile menu toggle functionality
        const mobileMenuToggle = document.querySelector('.mobile-menu-toggle');
        const mainNav = document.querySelector('.main-nav');
        
        if (mobileMenuToggle && mainNav) {
            mobileMenuToggle.addEventListener('click', function() {
                mainNav.classList.toggle('active');
                
                // Update aria-expanded for accessibility
                const isExpanded = mainNav.classList.contains('active');
                mobileMenuToggle.setAttribute('aria-expanded', isExpanded);
            });
            
            // Close menu when clicking on a link
            const navLinks = mainNav.querySelectorAll('a');
            navLinks.forEach(link => {
                link.addEventListener('click', () => {
                    mainNav.classList.remove('active');
                    mobileMenuToggle.setAttribute('aria-expanded', 'false');
                });
            });
            
            // Close menu when clicking outside
            document.addEventListener('click', function(e) {
                if (!mainNav.contains(e.target) && !mobileMenuToggle.contains(e.target)) {
                    mainNav.classList.remove('active');
                    mobileMenuToggle.setAttribute('aria-expanded', 'false');
                }
            });
        }
    </script>
</body>
</html>
